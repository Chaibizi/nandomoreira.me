---
layout: post
title: Personalização do menu categorias no topo do magento
date: 2012-12-22 00:07:04.000000000 -02:00
categories:
- Dicas
- Magento
tags:
- categorias
- dicas
- magento
- menu
- programação
- tutorial
status: draft
type: post
published: false
meta:
  _edit_last: '1'
  _aioseop_description: ! 'Recentemente passei por um projeto complicado, onde o designer
    resolver quebrar as pernas do desenvolvimento.


    Nesse projeto tínhamos um menu horizontal, onde foi listada todas as categorias
    e sub categorias do magento (Até ai tudo bem, pois isso é simples de se fazer,
    o próprio magento já traz tudo organizado com listas não ordenadas). Só que não!
    Não nesse projeto!'
  _thumbnail_id: '779'
  _aioseop_title: Personalização do menu categorias no topo do magento
  dsq_thread_id: '1248309392'
author:
  login: nandomoreira.me
  email: nandomoreira.me@gmail.com
  display_name: Fernando Moreira
  first_name: Fernando
  last_name: Moreira
excerpt: !ruby/object:Hpricot::Doc
  options: {}
---
<p>Olá meus amigos! Hoje vou falar um pouco sobre magento.</p>
<p>Recentemente passei por um projeto complicado, onde o designer resolver quebrar as pernas do desenvolvimento.</p>
<p>Nesse projeto tínhamos um menu horizontal, onde foi listada todas as categorias e sub categorias do magento (Até ai tudo bem, pois isso é simples de se fazer, o próprio magento já traz tudo organizado com listas não ordenadas). Só que não! Não nesse projeto!<br />
<!--more--></p>
<div style="float: right;">[adsense300x250]</div>
<p>Como eu disse acima, o danado do designer resolveu quebrar as pernas legal! Ele fez um menu colorido, com as categorias com cores diferentes e com um ícone especifico para cada, logo abaixo vinha suas filhas (sub-categorias), mas tipo formou-se mais um menu horizontal em baixo e depois vinham as netas (outas sub-categorias).</p>
<p>Não sei se você está conseguindo imaginar o grau de complexidade (pelo menos pra mim foi, e não ria).</p>
<p>Se você está com um problema parecido tenho certeza que esse tutorial irá te ajudar e muito.</p>
<p>Primeiro vamos achar o arquivo onde se encontra o menu horizontal do magento, vá em:<br />
<code>app/design/frontend/SEU_PACOTE(base)/SEU_TEMA(default)/template/page/html/</code><br />
nesse diretório encontre um arquivo chamado <code>"topmenu.phtml"</code>, abra-o em sua IDE e + ou - na linha 34 você verá algo como:</p>
<p>[gist id="bbca2c3c9fdf01415ac5"]</p>
<p>Bom, esse código pega as categorias que estão setadas como <strong>"sim"</strong> na opção <strong>"Include in Navigation Menu"</strong>, e como você já sabe, as organiza com Ul's (listas não ordenadas) e monta um menu "<em>drop draw</em>" com as sub-categorias, mas... Precisamos personalizar esse menu com CSS, colocar ícones e cores variadas.</p>
<p>É ai que entramos com nossa programação.</p>
<p>Comente o código do seu arquivo aberto para não perdê-lo (ou faça uma cópia).</p>
<p>Nossa primeira linha de código não será um PHP, mas sim um bloco HTML5 (nav)</p>
<p>[gist id="8985c77a1e5197bc5e3b"]</p>
<p><strong>Agora entramos com o PHP:</strong></p>
<p>No trecho acima estamos estanciando uma classe <em>Helper</em> do magento para as categorias e armazenando na variável "<code>$_helper</code>" e no trecho abaixo buscamos as categorias setando "<code>getStoreCategories()</code>" e armazenando em "<code>$_categories</code>":</p>
<p>Agora eu tenho um array em "<em>$_categories</em>" com minhas categorias mães (somente), sem suas filhas e netas.<br />
Ah! Se você quiser pegar as categorias atuais (current) faça assim:</p>
<p>Com nosso array em mãos montaremos o loop com "foreach", mas antes vamos verificar se existe alguma categoria em nosso array:</p>
<pre lang="php"><!--?php # verifica se existe o array com as categorias ?-->
<!--?php if (count($_categories) --> 0): ?&gt;
</pre>
<p>Com tudo nosso código ficaria + ou – assim:</p>
<pre lang="php"></pre>
<p>&nbsp;</p>
<nav id="menunav" class="grid_12"><!--?php # init helper category ?--> <!--?php $_helper = Mage::helper('catalog/category') ?--> <!--?php # primeiro buscaremos as categorias principais ?--> <!--?php $_categories = $_helper--->getStoreCategories() ?&gt; <!--?php #$currentCategory = Mage::registry('current_category') ?--> <!--?php # verifica se existe o array com as categorias ?--> <!--?php if (count($_categories) --> 0): ?&gt;  </nav>
<p>Até agora nós temos apenas as categorias mães, como você já sabe e meu foco não é explicar HTML e CSS aqui, nos menus "<em>drop draw</em>" as categorias filhas vão dentro de uma <em>ul</em> que estão dentro da <em>li</em> da categoria mãe, sabendo disso vamos fazer um 2º loop para as categorias FILHAS e um 3º loop para as categorias <em>NETAS</em>. Mas precisamos saber de quem aquela categoria é filha, certo? Corretíssimo meu caro amigo. Para essa façanha precisamos apenas do ID da categoria mãe. Fica assim:</p>
<pre lang="php"></pre>
<p>Quando eu chamo o método "<em>load()</em>" da classe e não passo nenhum parâmetro ele pega as categorias mães, porém ele recebe sim um parâmetro que no nosso caso é o ID. Sabendo o ID da categoria mãe o magento, que é muito inteligente por sinal, faz o filtro das categorias filhas.<br />
E assim você faria o loop novamente:</p>
<pre lang="php"><!--?php # precisamos instanciar novamente a classe Helper, mas agora passando o ID da categoria mãe ?-->
<!--?php $_subCategory = Mage::getModel('catalog/category')--->load($_subcategory-&gt;getId()) ?&gt;
<!--?php # optemos todas as categorias filhas ?-->
<!--?php $_subcategories = $_category--->getChildrenCategories() ?&gt;
<!--?php # verificamos se exite alguma categoria contando o array ?-->
<!--?php if (count($_subcategories) --> 0): ?&gt;
</pre>
<p>&nbsp;</p>
<p>Como o macete é meio braçal as <em>sub-categorias</em> não serão exibidas dinamicamente (você é esperto e deve ter notado isso) então você terá que fazer quantos loops forem necessários para o seu menu (no caso do meu projeto eu tive que fazer fiz 3).</p>
<p>Agora você está se perguntado: "tá e como eu faço para aplicar meus estilos?".</p>
<p>Simples, com esse macete você terá um livre acesso as li’s, ul’s e aos links do menu, aplicando classes e ID’s a vontade ou span’s que foi no meu caso para aplicar um ícone para a categoria mãe.<br />
Até que enfim chegamos ao fim! Espero que tenham se divertido com o passeio. (risos)</p>
<p>O código todo da "<em>bagaça</em>" está logo abaixo.</p>
<p>Abraços! :)</p>
<pre lang="php"></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
